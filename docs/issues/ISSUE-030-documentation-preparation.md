# Issue #030: ドキュメント整備

**Priority**: Medium  
**Difficulty**: Intermediate  
**Estimated Time**: 4-6 hours  
**Type**: Documentation  
**Labels**: documentation, user-guide, maintenance, knowledge-sharing

## Description

システムの運用・保守に必要な包括的なドキュメントを整備します。ユーザーマニュアル、管理者ガイド、開発者向けドキュメント、トラブルシューティングガイドを作成し、学校現場での円滑な運用をサポートします。

## Background

学校現場でのシステム運用を成功させるため、技術的な知識がない教職員でも理解できる操作マニュアルと、システム管理者向けの詳細な技術文書が必要です。また、将来的な機能拡張や保守作業に備えた開発者向けドキュメントも整備します。

## Acceptance Criteria

- [ ] ユーザーマニュアルが作成されている
- [ ] 管理者ガイドが作成されている
- [ ] インストール・セットアップガイドが作成されている
- [ ] トラブルシューティングガイドが作成されている
- [ ] APIドキュメントが作成されている
- [ ] 開発者向けドキュメントが更新されている
- [ ] FAQ文書が作成されている
- [ ] システム仕様書が作成されている

## Implementation Guidelines

### Getting Started

1. 全てのIssue（#001-#029）が完了していることを確認
2. 実装されたシステムの動作を把握
3. 学校現場での利用シーンを想定した文書構成を設計
4. わかりやすい文書作成のベストプラクティスを確認

### Main Implementation

#### 1. User Manual (ユーザーマニュアル)

##### docs/user-guide/README.md

```markdown
# 図書委員当番くん ユーザーマニュアル

## はじめに

図書委員当番くんは、小学校の図書委員の当番表を自動生成するシステムです。
このマニュアルでは、日常的な操作方法について説明します。

## 目次

1. [システムへのアクセス](#システムへのアクセス)
2. [基本的な操作](#基本的な操作)
3. [図書委員の管理](#図書委員の管理)
4. [当番表の確認と印刷](#当番表の確認と印刷)
5. [よくある質問](#よくある質問)

## システムへのアクセス

### ログイン方法

1. ブラウザで指定されたURLにアクセスします
2. メールアドレスとパスワードを入力します
3. 「ログイン」ボタンをクリックします

![ログイン画面](../images/login-screen.png)

**注意事項：**

- 管理者から提供されたアカウント情報を使用してください
- パスワードは第三者に教えないでください
- 使用後は必ずログアウトしてください

### ダッシュボード

ログイン後、ダッシュボードが表示されます。

![ダッシュボード](../images/dashboard.png)

**ダッシュボードの見方：**

- **図書委員数**: 現在登録されている図書委員の人数
- **クラス数**: 登録されているクラス数
- **今月の当番**: 今月の当番予定
- **クイックアクション**: よく使う機能へのショートカット

## 基本的な操作

### 画面の構成

- **ヘッダー**: システム名とログアウトボタン
- **サイドメニュー**: 各機能へのナビゲーション
- **メインエリア**: 選択した機能の画面
- **フッター**: システム情報

### ナビゲーション

| メニュー項目   | 説明                 |
| -------------- | -------------------- |
| ダッシュボード | システムの概要を表示 |
| 当番表管理     | 当番表の生成・確認   |
| 図書委員管理   | 図書委員の登録・編集 |
| クラス管理     | クラス情報の管理     |
| 図書室管理     | 図書室情報の管理     |
| システム設定   | システム全体の設定   |

## 図書委員の管理

### 新しい図書委員の登録

1. サイドメニューから「図書委員管理」をクリック
2. 「新規登録」ボタンをクリック
3. 必要な情報を入力：
   - **氏名**: 図書委員の名前（必須）
   - **学年**: 5年生または6年生を選択（必須）
   - **クラス**: 所属するクラスを選択（必須）
4. 「登録」ボタンをクリック

![図書委員登録](../images/student-registration.png)

### 図書委員情報の編集

1. 図書委員一覧から編集したい図書委員を探す
2. 該当行の「編集」ボタンをクリック
3. 情報を修正
4. 「更新」ボタンをクリック

### 図書委員の検索

- **名前検索**: 検索ボックスに名前を入力
- **学年フィルタ**: 学年を選択してフィルタリング
- **クラスフィルタ**: クラスを選択してフィルタリング

## 当番表の確認と印刷

### 当番表の生成

1. サイドメニューから「当番表管理」をクリック
2. 「スケジュール生成」ボタンをクリック
3. 生成する期間を選択：
   - **前期**: 4月〜9月
   - **後期**: 10月〜3月
4. 「生成開始」ボタンをクリック
5. 生成完了まで待機（通常1-2分）

![スケジュール生成](../images/schedule-generation.png)

### 当番表の表示

生成された当番表は以下の形式で表示されます：

- **グリッド表示**: カレンダー形式での表示
- **リスト表示**: 日付順のリスト表示
- **印刷用表示**: A4用紙に最適化された表示

### 印刷方法

1. 「印刷用表示」を選択
2. ブラウザの印刷機能を使用（Ctrl+P / Cmd+P）
3. 以下の設定を確認：
   - **用紙サイズ**: A4
   - **向き**: 縦
   - **余白**: 標準
4. 「印刷」をクリック

![印刷設定](../images/print-settings.png)

### 当番表の修正

自動生成された当番表に問題がある場合：

1. 該当する日付をクリック
2. 「担当者変更」をクリック
3. 新しい担当者を選択
4. 「保存」をクリック

**注意**: 手動での修正は最小限に留めることを推奨します。

## よくある質問

### Q: パスワードを忘れました

A: システム管理者にパスワードのリセットを依頼してください。

### Q: 図書委員が退任したときはどうすればよいですか？

A: 図書委員管理画面で該当する図書委員を「非アクティブ」に設定してください。完全に削除する必要はありません。

### Q: 当番表がうまく生成されません

A: 以下を確認してください：

- 図書委員が十分な人数登録されているか
- 図書室の定員設定が適切か
- システムエラーが発生していないか

### Q: 印刷した当番表が見切れます

A: ブラウザの印刷設定で「ページに合わせて縮小」を選択してください。

### Q: システムが重い・遅い

A: 以下を試してください：

- ブラウザを再起動
- 他のタブを閉じる
- インターネット接続を確認

## サポート

技術的な問題や操作方法でご不明な点がある場合は、システム管理者にお問い合わせください。

**連絡先**: [管理者のメールアドレスを記載]
```

#### 2. Administrator Guide (管理者ガイド)

##### docs/admin-guide/README.md

```markdown
# 図書委員当番くん 管理者ガイド

## 概要

このガイドは、システム管理者向けの詳細な運用・保守手順を説明します。

## 管理者の責任範囲

- ユーザーアカウントの管理
- システム設定の調整
- データのバックアップと復旧
- 年度末のデータリセット
- システムの監視とメンテナンス

## システム設定

### 基本設定

システム設定画面では以下の項目を管理できます：

#### システム情報

- バージョン情報の確認
- データベース接続状況
- システム稼働状況

#### データ統計

- 図書委員数の確認
- クラス数の確認
- 当番割り当て状況

### ユーザー管理

#### 新規ユーザーの作成

Supabaseの管理画面から新規ユーザーを作成します：

1. Supabase Dashboard にアクセス
2. Authentication > Users に移動
3. "Add user" をクリック
4. メールアドレスとパスワードを設定
5. メタデータに表示名を追加

#### パスワードリセット

1. Supabase Dashboard のUsers画面
2. 該当ユーザーを選択
3. "Reset password" をクリック
4. 新しいパスワードをユーザーに連絡

### データ管理

#### データエクスポート

定期的なバックアップとして実行してください：

1. システム設定 > データ管理
2. 「データエクスポート」をクリック
3. JSONファイルがダウンロードされます
4. 安全な場所に保存してください

**推奨頻度**: 月1回、重要な変更後

#### データリセット（年度末）

新年度開始前に実行します：

1. **事前準備**:
   - 現在のデータをエクスポート
   - バックアップファイルの安全な保管
   - 新年度のクラス情報を準備

2. **リセット手順**:
   - システム設定 > データ管理
   - 「データリセット」をクリック
   - リセット対象を選択：
     - 当番表のみ: スケジュールデータのみ削除
     - 図書委員と当番表: 図書委員データも削除
     - すべてのデータ: 完全リセット
   - 管理者パスワードを入力
   - 「リセット実行」をクリック

**注意**: この操作は取り消せません。必ずバックアップを取ってから実行してください。

### システム監視

#### ヘルスチェック

定期的にシステムの状態を確認してください：

- URL: `https://your-domain.com/api/health`
- 正常時: `{"status": "healthy"}` が返される
- 異常時: エラーメッセージが返される

#### ログの確認

Vercel Dashboard でシステムログを確認できます：

1. Vercel Dashboard にアクセス
2. プロジェクトを選択
3. "Functions" タブでAPIの実行ログを確認

#### パフォーマンス監視

- Vercel Analytics でページの読み込み速度を監視
- Speed Insights でCore Web Vitalsを確認

## トラブルシューティング

### よくある問題と解決方法

#### 問題: ログインできない

**原因と対策**:

- パスワード間違い → パスワードリセット
- アカウントが無効 → Supabaseで確認
- システムエラー → ログ確認

#### 問題: データが表示されない

**確認事項**:

- データベース接続状況
- Supabaseの稼働状況
- APIエラーログ

#### 問題: 当番表生成が失敗する

**確認事項**:

- 図書委員数が十分か（推奨：図書室定員×2以上）
- 図書室設定が適切か
- システムエラーログ

### エラーログの読み方
```

[timestamp] ERROR: Failed to generate schedule
Cause: Insufficient students for room allocation
Room: 図書室A (capacity: 4)
Available students: 3

```

この例では、図書室Aの定員4名に対して利用可能な図書委員が3名しかいないため、スケジュール生成に失敗しています。

### 緊急時の対応

#### システムダウン時
1. Vercel Dashboardで稼働状況を確認
2. Supabaseの稼働状況を確認
3. 必要に応じてサポートに連絡

#### データ破損時
1. 最新のバックアップファイルを確認
2. システムリセット後にデータ復旧
3. 必要に応じて手動でデータを再入力

## セキュリティ

### アクセス管理
- 定期的なパスワード変更を推奨
- 不要なアカウントの削除
- ログイン履歴の確認

### データ保護
- 定期的なバックアップ
- バックアップファイルの暗号化
- 外部への情報漏洩防止

## 年間スケジュール

| 時期 | 作業内容 |
|------|----------|
| 3月 | 年度末データのバックアップ |
| 4月 | 新年度データのリセット・新クラス登録 |
| 4-5月 | 新図書委員の登録 |
| 6月 | 前期スケジュール生成 |
| 9月 | 後期スケジュール生成 |
| 12月 | 年末バックアップ |

## サポート連絡先

技術的な問題は以下に連絡してください：

- 開発者: [開発者連絡先]
- Vercelサポート: [サポートURL]
- Supabaseサポート: [サポートURL]
```

#### 3. Installation Guide

##### docs/installation/README.md

````markdown
# インストール・セットアップガイド

## 前提条件

### 必要なアカウント

- GitHub アカウント
- Vercel アカウント
- Supabase アカウント

### 必要なソフトウェア

- Node.js 18 以上
- npm または pnpm
- Git

## セットアップ手順

### 1. リポジトリのクローン

```bash
git clone https://github.com/your-org/tosho-in-wariate-kun.git
cd tosho-in-wariate-kun
```
````

### 2. 依存関係のインストール

```bash
npm install
```

### 3. Supabase プロジェクトの作成

1. [Supabase](https://supabase.com) にアクセス
2. "New project" をクリック
3. プロジェクト名と初期設定を入力
4. データベースパスワードを設定

### 4. 環境変数の設定

`.env.local` ファイルを作成：

```bash
cp .env.local.example .env.local
```

必要な環境変数を設定：

```env
NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your-anon-key
SUPABASE_SERVICE_ROLE_KEY=your-service-role-key
DATABASE_URL=your-database-url
```

### 5. データベースの初期化

```bash
npx prisma db push
```

### 6. 開発サーバーの起動

```bash
npm run dev
```

ブラウザで `http://localhost:3000` にアクセス

### 7. 本番環境デプロイ（Vercel）

1. Vercel に GitHub リポジトリを連携
2. 環境変数を設定
3. デプロイ実行

詳細は [デプロイメントガイド](../deployment/) を参照してください。

## 初期データのセットアップ

### 管理者アカウントの作成

Supabase Dashboard から初期管理者を作成：

1. Authentication > Users
2. "Add user" でメールアドレスとパスワードを設定
3. User MetaData に `{"displayName": "管理者名"}` を追加

### 基本データの登録

システムにログイン後、以下の順序でデータを登録：

1. **クラス情報**: 5年A組、5年B組など
2. **図書室情報**: 図書室A、図書室Bなど
3. **図書委員情報**: 各クラスの図書委員

## トラブルシューティング

### よくある問題

#### データベース接続エラー

- 環境変数の確認
- Supabase プロジェクトの稼働状況確認

#### ビルドエラー

- Node.js バージョンの確認
- 依存関係の再インストール

```bash
rm -rf node_modules
npm install
```

#### 権限エラー

- Supabase の Row Level Security 設定確認
- Service Role Key の確認

## サポート

セットアップでご不明な点がある場合は、[Issues](https://github.com/your-org/tosho-in-wariate-kun/issues) でお問い合わせください。

````

#### 4. API Documentation

##### docs/api/README.md
```markdown
# API ドキュメント

## 概要

図書委員当番システムのREST APIドキュメントです。

## 認証

すべてのAPIエンドポイントはJWT認証が必要です。

````

Authorization: Bearer <jwt-token>

```

## エンドポイント一覧

### 認証 (Authentication)

#### ログイン
```

POST /api/auth/login

````

**リクエスト**:
```json
{
  "email": "user@example.com",
  "password": "password"
}
````

**レスポンス**:

```json
{
  "success": true,
  "data": {
    "user": {
      "id": "uuid",
      "email": "user@example.com",
      "displayName": "ユーザー名"
    },
    "session": {
      "access_token": "jwt-token",
      "expires_at": 1234567890
    }
  }
}
```

### 図書委員管理 (Students)

#### 図書委員一覧取得

```
GET /api/students?page=1&limit=20&search=検索語&grade=5&isActive=true
```

**クエリパラメータ**:

- `page`: ページ番号（デフォルト: 1）
- `limit`: 取得件数（デフォルト: 20、最大: 100）
- `search`: 名前での検索
- `grade`: 学年フィルタ（5または6）
- `isActive`: アクティブ状態フィルタ

**レスポンス**:

```json
{
  "success": true,
  "data": {
    "students": [
      {
        "id": "uuid",
        "name": "図書委員名",
        "grade": 5,
        "classId": "class-uuid",
        "isActive": true,
        "createdAt": "2024-01-01T00:00:00.000Z",
        "class": {
          "name": "A",
          "year": 5
        }
      }
    ],
    "pagination": {
      "page": 1,
      "limit": 20,
      "total": 50,
      "totalPages": 3
    }
  }
}
```

#### 図書委員作成

```
POST /api/students
```

**リクエスト**:

```json
{
  "name": "図書委員名",
  "grade": 5,
  "classId": "class-uuid",
  "isActive": true
}
```

#### 図書委員更新

```
PUT /api/students/{id}
```

#### 図書委員削除

```
DELETE /api/students/{id}
```

### スケジュール管理 (Schedules)

#### スケジュール生成

```
POST /api/schedules/generate
```

**リクエスト**:

```json
{
  "term": "FIRST_TERM",
  "forceRegenerate": false
}
```

**レスポンス**:

```json
{
  "success": true,
  "data": {
    "message": "スケジュールを生成しました",
    "stats": {
      "totalAssignments": 120,
      "studentsAssigned": 24,
      "averageAssignments": 5.0
    }
  }
}
```

## エラーレスポンス

すべてのエラーは以下の形式で返されます：

```json
{
  "success": false,
  "error": {
    "code": "ERROR_CODE",
    "message": "エラーメッセージ",
    "details": {}
  }
}
```

### エラーコード一覧

| コード           | 説明                   |
| ---------------- | ---------------------- |
| VALIDATION_ERROR | バリデーションエラー   |
| UNAUTHORIZED     | 認証エラー             |
| FORBIDDEN        | 権限エラー             |
| NOT_FOUND        | リソースが見つからない |
| CONFLICT         | 競合エラー             |
| INTERNAL_ERROR   | サーバー内部エラー     |

## レート制限

- 一般API: 1分間に60リクエスト
- 認証API: 1分間に10リクエスト
- スケジュール生成: 1時間に5リクエスト

## Postman Collection

APIテスト用のPostman Collectionは [こちら](./postman-collection.json) からダウンロードできます。

````

#### 5. FAQ Document

##### docs/faq/README.md
```markdown
# よくある質問（FAQ）

## 基本的な使い方

### Q: システムにアクセスできません
**A**: 以下を確認してください：
- インターネット接続が正常か
- 正しいURLにアクセスしているか
- ブラウザが最新版か（Chrome、Firefox、Safari、Edge推奨）
- 管理者から提供されたアカウント情報が正しいか

### Q: パスワードを忘れました
**A**: システム管理者にパスワードリセットを依頼してください。セキュリティ上、パスワードをメールで送信することはできません。

## 図書委員管理

### Q: 図書委員を間違って削除してしまいました
**A**: 削除された図書委員の復旧はできません。再度登録し直してください。今後は削除の代わりに「非アクティブ」設定を使用することを推奨します。

### Q: 転校生の図書委員はどう扱えばよいですか？
**A**:
- **転入**: 新規図書委員として登録
- **転出**: 「非アクティブ」に設定（削除はしない）

### Q: 図書委員の人数に制限はありますか？
**A**: システム上の制限はありませんが、効率的なスケジュール生成のため、図書室の総定員の2倍以上の図書委員を登録することを推奨します。

## 当番表・スケジュール

### Q: 当番表の生成に時間がかかります
**A**: 図書委員数や図書室数によって処理時間は変わります。通常1-2分程度です。5分以上かかる場合は管理者に連絡してください。

### Q: 生成された当番表が不公平に見えます
**A**: システムは以下のルールで公平性を保っています：
- 各図書委員の当番回数を均等に調整
- 同じクラスの図書委員が同日にならないよう配慮
- 図書室ごとの負荷分散

### Q: 特定の日の当番を変更したいです
**A**: 当番表画面で該当日をクリックし、「担当者変更」から修正できます。ただし、手動修正は最小限に留めることを推奨します。

### Q: 前期と後期で当番表を分ける理由は？
**A**:
- 学期ごとの図書委員の変更に対応
- システムの処理負荷分散
- 学校行事による調整の容易さ

## 印刷・出力

### Q: 印刷時に当番表が切れてしまいます
**A**:
1. 「印刷用表示」を選択
2. ブラウザの印刷設定で「ページに合わせて縮小」を選択
3. 用紙サイズをA4、向きを縦に設定

### Q: PDFで保存したいです
**A**: ブラウザの印刷機能で「PDFに保存」を選択してください。Chrome、Firefox、Safariで対応しています。

### Q: エクセル形式でデータを出力できますか？
**A**: 現在はCSV形式での出力のみ対応しています。CSVファイルはExcelで開くことができます。

## システム設定・管理

### Q: 年度末のデータ処理はどうすればよいですか？
**A**: 管理者が以下の手順で行います：
1. 現在のデータをエクスポート（バックアップ）
2. 新年度用にデータリセット
3. 新しいクラス・図書委員情報を登録

### Q: データが消えてしまった場合の復旧は可能ですか？
**A**: 定期的なバックアップがあれば復旧可能です。管理者に相談してください。

### Q: システムの動作が重い場合はどうすればよいですか？
**A**:
1. ブラウザの再起動
2. 他のタブ・アプリケーションを閉じる
3. インターネット接続速度の確認
4. 改善しない場合は管理者に連絡

## エラー・トラブル

### Q: 「権限がありません」というエラーが出ます
**A**:
- ログイン状態を確認
- 管理者権限が必要な機能の場合、管理者に依頼
- セッション切れの場合は再ログイン

### Q: 「データベースエラー」が表示されます
**A**: 一時的な問題の可能性があります：
1. ページを再読み込み
2. 少し時間をおいて再試行
3. 解決しない場合は管理者に連絡

### Q: スマートフォンで使用できますか？
**A**: レスポンシブ対応により、スマートフォンやタブレットでも基本機能は使用可能です。ただし、印刷や複雑な操作はパソコンでの使用を推奨します。

## その他

### Q: 他の学校でも使用できますか？
**A**: はい。システムは汎用的に設計されているため、小学校であれば他校でも使用可能です。セットアップについては開発者にお問い合わせください。

### Q: 機能の追加要望はどこに連絡すればよいですか？
**A**: システム管理者または開発者に連絡してください。GitHub Issuesでも受け付けています。

### Q: システムの利用料金は？
**A**: オープンソースソフトウェアのため、ソフトウェア自体に利用料金はかかりません。ただし、クラウドサービス（Vercel、Supabase）の利用料金が別途発生する場合があります。

---

**サポート連絡先**:
- システム管理者: [管理者メール]
- 開発者: [開発者連絡先]
- GitHub Issues: [リポジトリURL]/issues
````

### Resources

- [Technical Writing Best Practices](https://developers.google.com/technical-writing)
- [User Manual Templates](https://blog.prototypr.io/how-to-write-a-user-manual-that-doesnt-suck-6c98a58b5120)
- [API Documentation Standards](https://swagger.io/resources/articles/best-practices-in-api-documentation/)

## Implementation Results

### Work Completed

- [ ] ユーザーマニュアル作成
- [ ] 管理者ガイド作成
- [ ] インストールガイド作成
- [ ] APIドキュメント作成
- [ ] FAQ文書作成
- [ ] トラブルシューティングガイド作成
- [ ] システム仕様書更新

### Testing Results

- [ ] ドキュメント内容の正確性確認
- [ ] 操作手順の実行可能性確認
- [ ] 学校現場での使いやすさ確認
- [ ] 技術文書の完整性確認

### Code Review Feedback

<!-- コードレビューでの指摘事項と対応を記録 -->

## Next Steps

このIssue完了後の次のタスク：

1. 学校現場でのユーザーテスト実施
2. フィードバックに基づくドキュメント改善
3. 運用開始準備
