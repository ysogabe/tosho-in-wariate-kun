# Mock Backend テスト仕様書

## 1. 概要

### 1.1 テスト対象システム
- **システム名**: 図書委員当番割り当てシステム Mock Backend
- **対象バージョン**: v1.0
- **テスト日程**: 2025年5月25日
- **責任者**: プロジェクトチーム

### 1.2 テスト目的
- Mock Backendの全機能が正しく動作することを検証する
- スケジュール生成アルゴリズムの正確性を確認する
- API エンドポイントの動作を保証する
- データベース操作の整合性を検証する

### 1.3 テスト範囲
- API エンドポイント（CRUD操作）
- スケジュール生成エンジン
- データベース操作
- ビジネスロジックの検証

## 2. テスト環境

### 2.1 ハードウェア環境
- OS: macOS / Linux / Windows
- Python: 3.8以上
- メモリ: 4GB以上

### 2.2 ソフトウェア環境
- Python 3.13
- Flask
- SQLite3
- pytest / unittest

### 2.3 テストデータ
- 学年: 3年間（1年生、2年生、3年生）
- クラス: 各学年4クラス
- 図書委員: 各クラス1名（合計12名）
- 図書室: 2室（第一図書室、第二図書室）

## 3. テスト項目

### 3.1 API エンドポイントテスト

#### 3.1.1 学年管理API
- **GET /api/grades**: 学年一覧取得
- **POST /api/grades**: 学年登録
- **PUT /api/grades/:id**: 学年更新
- **DELETE /api/grades/:id**: 学年削除

#### 3.1.2 クラス管理API
- **GET /api/classes**: クラス一覧取得
- **POST /api/classes**: クラス登録
- **PUT /api/classes/:id**: クラス更新
- **DELETE /api/classes/:id**: クラス削除

#### 3.1.3 図書委員管理API
- **GET /api/committee-members**: 図書委員一覧取得
- **POST /api/committee-members**: 図書委員登録
- **PUT /api/committee-members/:id**: 図書委員更新
- **DELETE /api/committee-members/:id**: 図書委員削除

#### 3.1.4 図書室管理API
- **GET /api/libraries**: 図書室一覧取得
- **POST /api/libraries**: 図書室登録
- **PUT /api/libraries/:id**: 図書室更新
- **DELETE /api/libraries/:id**: 図書室削除

#### 3.1.5 スケジュール管理API
- **GET /api/schedules**: スケジュール一覧取得
- **POST /api/schedules**: スケジュール生成
- **GET /api/schedules/:id**: スケジュール詳細取得
- **DELETE /api/schedules/:id**: スケジュール削除

#### 3.1.6 スケジュール割り当てAPI
- **GET /api/schedule-assignments**: 割り当て一覧取得
- **POST /api/schedule-assignments**: 割り当て作成
- **PUT /api/schedule-assignments/:id**: 割り当て更新
- **DELETE /api/schedule-assignments/:id**: 割り当て削除

### 3.2 スケジュール生成エンジンテスト

#### 3.2.1 基本機能テスト
- **テスト項目**: ScheduleGeneratorクラスの初期化
- **期待値**: 正常にインスタンス生成される
- **確認内容**: academic_year, is_first_halfパラメータが正しく設定される

#### 3.2.2 データ読み込みテスト
- **テスト項目**: 図書委員データの読み込み
- **期待値**: 12名の図書委員データが正しく読み込まれる
- **確認内容**: 各委員の情報（名前、クラス、学年）が正確である

- **テスト項目**: 図書室データの読み込み
- **期待値**: 2つの図書室データが正しく読み込まれる
- **確認内容**: 図書室の名前、アクティブ状態が正確である

#### 3.2.3 スケジュール生成テスト
- **テスト項目**: 前期スケジュール生成
- **期待値**: 4月〜9月の平日当番スケジュールが生成される
- **確認内容**: 
  - 各日に適切な図書委員が割り当てられている
  - 水曜・金曜は2名体制になっている
  - 1人の委員が同一日に複数回割り当てられていない

- **テスト項目**: 後期スケジュール生成
- **期待値**: 10月〜3月の平日当番スケジュールが生成される
- **確認内容**: 前期と同様の制約が満たされている

#### 3.2.4 制約チェックテスト
- **テスト項目**: 同一日複数割り当てチェック
- **期待値**: 1人の委員が同一日に複数回割り当てられない
- **確認内容**: エラーケースでの適切な例外処理

- **テスト項目**: 公平性チェック
- **期待値**: 各委員の当番回数の差が最小限に抑えられる
- **確認内容**: 最多回数と最少回数の差が2回以下

### 3.3 データベース操作テスト

#### 3.3.1 接続テスト
- **テスト項目**: データベース接続・切断
- **期待値**: 正常に接続・切断される
- **確認内容**: 接続プールの管理が適切である

#### 3.3.2 CRUD操作テスト
- **テスト項目**: データの作成・読み取り・更新・削除
- **期待値**: 各操作が正常に実行される
- **確認内容**: データの整合性が保たれる

#### 3.3.3 トランザクション管理テスト
- **テスト項目**: 複数操作のトランザクション処理
- **期待値**: コミット・ロールバックが正常に動作する
- **確認内容**: データの一貫性が保たれる

### 3.4 エラー処理テスト

#### 3.4.1 バリデーションエラー
- **テスト項目**: 不正なリクエストパラメータ
- **期待値**: 適切なエラーメッセージが返される
- **確認内容**: HTTPステータスコードが400番台

#### 3.4.2 データベースエラー
- **テスト項目**: データベース接続失敗
- **期待値**: 適切なエラーハンドリングが行われる
- **確認内容**: システムが適切に復旧する

### 3.5 パフォーマンステスト

#### 3.5.1 レスポンス時間テスト
- **テスト項目**: API応答時間の測定
- **期待値**: 1秒以内の応答
- **確認内容**: 負荷時でも性能が維持される

#### 3.5.2 同時実行テスト
- **テスト項目**: 複数リクエストの同時処理
- **期待値**: データ競合が発生しない
- **確認内容**: ロック機構が正常に動作する

## 4. テスト実行手順

### 4.1 事前準備
1. 仮想環境の作成
```bash
python -m venv venv
source venv/bin/activate  # Windows: venv\Scripts\activate
```

2. 依存関係のインストール
```bash
pip install -r requirements.txt
```

3. データベースの初期化
```bash
python init_database.py
```

### 4.2 テスト実行
1. 全テストの実行
```bash
python -m pytest tests/ -v --tb=short
```

2. 個別テストファイルの実行
```bash
python -m pytest tests/test_api_schedules.py -v
```

3. カバレッジレポートの生成
```bash
python -m pytest tests/ --cov=. --cov-report=html
```

### 4.3 結果確認
1. テスト結果の確認
2. カバレッジレポートの確認
3. パフォーマンス指標の確認

## 5. テスト結果の評価基準

### 5.1 成功基準
- **機能テスト**: 全テストケースが成功する
- **パフォーマンステスト**: 応答時間が基準値以内
- **カバレッジ**: コードカバレッジが80%以上

### 5.2 品質基準
- **バグ密度**: クリティカル・メジャーバグが0件
- **可用性**: 99.9%以上の稼働率
- **保守性**: コードの複雑度が基準値以内

## 6. 改善提案

### 6.1 テストの自動化
- CI/CDパイプラインの構築
- 継続的テストの実施
- 自動デプロイメントの導入

### 6.2 監視・運用
- ログ監視の強化
- パフォーマンス監視の導入
- アラート機能の追加

## 7. 付録

### 7.1 テストデータサンプル
```json
{
  "grades": [
    {"id": 1, "name": "1年生", "year": 1},
    {"id": 2, "name": "2年生", "year": 2},
    {"id": 3, "name": "3年生", "year": 3}
  ],
  "classes": [
    {"id": 1, "name": "1年A組", "grade_id": 1},
    {"id": 2, "name": "1年B組", "grade_id": 1}
  ]
}
```

### 7.2 期待されるAPI応答例
```json
{
  "success": true,
  "data": {
    "schedule_id": 1,
    "assignments": [
      {
        "date": "2025-04-01",
        "library_id": 1,
        "committee_member_id": 1
      }
    ]
  }
}
```

---

**文書作成日**: 2025年5月25日  
**最終更新日**: 2025年5月25日  
**作成者**: システム開発チーム
