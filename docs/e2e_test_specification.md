# E2Eテスト仕様書

## 概要

本ドキュメントは図書館当番割り当てシステムのEnd-to-End（E2E）テストの仕様を定義します。

## テスト環境

- **テストフレームワーク**: Playwright
- **対象ブラウザ**: Chromium, Firefox, Safari
- **フロントエンド**: React (Next.js) - http://localhost:3000
- **バックエンド**: Python Flask - http://localhost:3001

## テストカテゴリ

### 1. UI変更テスト（ui-changes.spec.js）

#### 1.1 管理画面のテスト
- **目的**: 管理画面の基本機能とナビゲーションの確認
- **対象機能**: 
  - 学年管理機能の非表示確認
  - 図書室管理機能の表示確認
  - クラス一覧での学年カラム非表示確認

#### 1.2 テストケース

| テストケース | 期待結果 | 優先度 |
|-------------|---------|--------|
| 管理画面に学年管理が表示されていない | 学年管理カードが存在しない | High |
| 図書室管理で第一図書室と第二図書室が表示される | 両方の図書室が確認できる | High |
| クラス一覧に学年カラムが表示されていない | 学年カラムが存在しない | High |

### 2. スケジュール生成テスト（schedule-generation.spec.js）

#### 2.1 スケジュール生成機能のテスト
- **目的**: スケジュール生成機能の包括的テスト
- **対象機能**:
  - スケジュール生成ページの表示
  - フォーム入力検証
  - スケジュール生成処理
  - 結果表示

#### 2.2 テストケース

| テストケース | 前提条件 | 操作 | 期待結果 | 優先度 |
|-------------|---------|------|---------|--------|
| スケジュール生成ページ表示 | ページアクセス | ページ読み込み | 必要な要素が表示される | High |
| 必須項目未入力エラー | フォーム表示 | 空のまま送信 | エラーメッセージ表示 | High |
| 日付範囲検証 | フォーム表示 | 不正な日付入力 | バリデーションエラー | Medium |
| スケジュール生成成功 | 正常データ入力 | 生成ボタンクリック | 成功メッセージとスケジュール表示 | High |

### 3. 週間スケジュールテスト（weekly-schedule.spec.js）

#### 3.1 週間スケジュール表示のテスト
- **目的**: 週間スケジュール機能の動作確認
- **対象機能**:
  - 週間カレンダー表示
  - スケジュール詳細表示
  - ナビゲーション機能

#### 3.2 テストケース

| テストケース | 期待結果 | 優先度 |
|-------------|---------|--------|
| 週間カレンダー表示 | 7日間のカレンダーが表示される | High |
| スケジュール詳細表示 | 各日の割り当て詳細が確認できる | High |
| 週ナビゲーション | 前週・次週への移動が可能 | Medium |

## テスト実行環境の設定

### データベース初期化
- **ファイル**: `global-setup.js`, `setup.js`
- **目的**: 各テスト実行前のデータベース状態を統一
- **処理**: テストデータの投入、既存データのクリア

### テスト実行コマンド

```bash
# 全E2Eテスト実行
npx playwright test

# 特定のテストファイル実行
npx playwright test e2e/ui-changes.spec.js

# ヘッドモードでの実行（ブラウザ表示）
npx playwright test --headed

# デバッグモード
npx playwright test --debug
```

## CI/CD連携

### GitHub Actions設定
- **ワークフローファイル**: `.github/workflows/e2e-tests.yml`
- **実行トリガー**: Pull Request、main branch へのプッシュ
- **並列実行**: 複数ブラウザでの同時テスト

### レポート出力
- **HTML レポート**: `playwright-report/`
- **テスト結果**: `test-results/`
- **スクリーンショット**: 失敗時の自動保存

## メンテナンス指針

### テスト追加時の注意点
1. 適切なテストカテゴリへの分類
2. 前提条件の明確化
3. データベース状態の考慮
4. 非同期処理の適切な待機

### 定期見直し項目
1. テストケースの有効性確認
2. セレクタの保守性確認
3. 実行時間の最適化
4. 新機能追加に伴うテスト拡張

## 関連ドキュメント
- [Mock Backend テスト仕様書](./mock_backend_test_specification.md)
- [システム全体テスト戦略](./test_strategy.md)
