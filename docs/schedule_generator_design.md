# スケジュール生成クラス設計書

## 概要

図書委員の当番スケジュールを自動生成するためのクラスを設計・実装する。このクラスは指定されたルールに従って、図書委員を曜日単位で割り当てる。

## 要件

- 5年、6年生が担当
- 各学年は2以上の任意クラスで構成
- 各クラスには、2−3人の図書委員がいる
- 図書室は1つ以上任意の数がある。データベースから図書室一覧を取得し、割り当てる
- 月曜日から金曜日に図書委員の当番を割り当てる
- 予定表は、年二回作成し当番を入れ替える（前期・後期）
- 前半、水曜日と金曜日の当番だった図書委員は、後半水曜日と金曜日の担当とならないようにする
- 各図書委員は、週二回担当日がある
- 同じクラスの図書員は同じ曜日の担当とならないようにする
- 各学年の委員が均等に配置、曜日によって偏らないようにする
- 割り当ては曜日単位で行い、日単位では行わない

## クラス設計

### `ScheduleGenerator` クラス


#### 属性

- `committee_members`: 図書委員リスト
- `libraries`: 図書室リスト
- `schedule_id`: 生成されたスケジュールID
- `is_first_half`: 前期か後期かのフラグ
- `academic_year`: 学年度

#### メソッド

- `__init__(self, academic_year: str, is_first_half: bool)`: コンストラクタ
- `load_committee_members(self) -> List[Dict]`: 図書委員データの読み込み
- `load_libraries(self) -> List[Dict]`: 図書室データの読み込み
- `create_schedule(self, name: str, description: str, start_date: str, end_date: str) -> int`: スケジュールの基本情報を作成
- `assign_members_to_weekdays(self) -> Dict`: 図書委員を曜日に割り当て
- `save_assignments(self, assignments: Dict, schedule_id: int) -> None`: 割り当てをデータベースに保存
- `generate(self, name: str, description: str, start_date: str, end_date: str) -> int`: スケジュール生成のメインメソッド

## アルゴリズム概要

1. 学年度と前期/後期の情報を受け取る
2. 図書委員と図書室のデータを読み込む
3. スケジュールの基本情報をデータベースに作成
4. 曜日ごとに図書委員を割り当てる
   - 各図書委員が週2回担当になるよう割り当て
   - 同じクラスの図書委員が同じ曜日にならないよう調整
   - 各学年の委員が均等に配置されるよう調整
   - 後期の場合、前期に水曜・金曜担当だった委員は水曜・金曜に割り当てない
5. 割り当て結果をデータベースに保存
6. スケジュールIDを返す

## データベース設計

既存のデータベース構造を利用し、以下のテーブルにデータを格納する：

- `schedules`: スケジュールの基本情報
- `schedule_assignments`: 割り当て情報（スケジュールID、図書室ID、曜日）
- `assignment_members`: 割り当てられた図書委員情報

## APIエンドポイント

`/api/generate-schedule` エンドポイントを修正し、新しいパラメータを受け付けるようにする：

- `academicYear`: 学年度（例: "2025"）
- `isFirstHalf`: 前期か後期か（true/false）

## フロントエンド変更

- スケジュール生成画面から「スケジュールルール設定」を削除
- スケジュール生成画面に「学年度」と「前期/後期」の選択肢を追加
- APIとの連携部分を修正
