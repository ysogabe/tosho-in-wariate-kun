# スケジュールジェネレーター テスト仕様書

## 1. 概要

本ドキュメントは、図書委員スケジュール生成機能（スケジュールジェネレーター）のテスト仕様を定義します。スケジュールジェネレーターは、図書委員を曜日ごとに割り当てるロジックを実装しており、このテスト仕様書では単体テストの内容と実行方法について記述します。

## 2. テスト対象

- `schedule_generator_class.py`: スケジュールジェネレータークラス
- `generate_schedule_with_class()`: スケジュール生成関数

## 3. テスト環境

- Python 3.9以上
- SQLite3データベース（テスト用インメモリデータベースおよび実ファイル）
- unittest フレームワーク
- coverage.py（コードカバレッジ計測用）

## 4. テスト前提条件

1. テスト実行前にデータベースが初期化されていること
2. テストデータが適切に準備されていること
3. 仮想環境（venv）が適切に設定されていること

## 5. テストケース

### 5.1 データベース接続テスト

| テストID | テスト内容 | 期待結果 |
|----------|------------|----------|
| DB-001   | データベースファイルの存在確認 | データベースファイルが存在すること |
| DB-002   | テーブル構造の確認 | 必要なテーブルが存在すること |
| DB-003   | 複数接続の管理確認 | 一方の接続を閉じても他方が影響を受けないこと |

### 5.2 データ読み込みテスト

| テストID | テスト内容 | 期待結果 |
|----------|------------|----------|
| READ-001 | 図書委員データ読み込み | 図書委員データが正しく読み込まれること |
| READ-002 | 図書室データ読み込み | 図書室データが正しく読み込まれること |

### 5.3 スケジュール生成テスト

| テストID | テスト内容 | 期待結果 |
|----------|------------|----------|
| GEN-001  | スケジュール基本情報作成 | スケジュールの基本情報が正しく作成されること |
| GEN-002  | 図書委員の曜日割り当て | 図書委員が条件に従って曜日に割り当てられること |
| GEN-003  | 割り当て保存 | 割り当てがデータベースに正しく保存されること |
| GEN-004  | スケジュール生成メイン処理 | 一連のスケジュール生成処理が正しく実行されること |

### 5.4 ルール適用テスト

| テストID | テスト内容 | 期待結果 |
|----------|------------|----------|
| RULE-001 | 週2回以下の割り当てルール | 各図書委員が週に2回以下の割り当てであること |
| RULE-002 | 同じクラスの重複回避ルール | 同じクラスの図書委員が同じ曜日に割り当てられないこと |
| RULE-003 | 前期・後期ルール | 前期に水曜・金曜担当だった委員が後期に水曜・金曜に割り当てられないこと |

## 6. テスト実行方法

### 6.1 単体テスト実行

```bash
cd /path/to/tosho-in-wariate-kun/mock_backend
python -m unittest tests/test_schedule_generator_fixed_class.py
```

### 6.2 カバレッジ計測付きテスト実行

```bash
cd /path/to/tosho-in-wariate-kun/mock_backend
python run_tests.py
```

## 7. テスト結果の評価基準

- すべてのテストケースが成功すること
- コードカバレッジが80%以上であること
- データベース接続に関するエラーが発生しないこと
- 割り当てルールが正しく適用されていること

## 8. 既知の制限事項

- テスト環境ではインメモリデータベースを使用するため、実環境との差異が生じる可能性がある
- ランダム要素を含むため、テスト実行ごとに割り当て結果が異なる可能性がある

## 9. 変更履歴

| 日付 | バージョン | 変更内容 | 変更者 |
|------|------------|----------|--------|
| 2025-05-25 | 1.0 | 初版作成 | Cascade |
