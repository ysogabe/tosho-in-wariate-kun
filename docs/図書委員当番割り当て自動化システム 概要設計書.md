# **図書委員当番割り当て自動化システム 概要設計書**

バージョン: 1.2  
作成日: 2025年6月24日

## **1\. はじめに**

### **1.1. 本書の目的**

本ドキュメントは、小学校における図書委員の当番割り当てを自動化するシステムのMVP（Minimum Viable Product）開発にあたり、その目的、機能、仕様を定義するものです。システムの利用者（教員）と開発者の間で共通認識を持つことを目的とします。

### **1.2. プロダクトの目的**

教員が手作業で行っている、複雑なルールに基づいた図書委員の当番表作成業務を自動化します。これにより、教員の作業負担を劇的に軽減し、ミスのない公平な当番表を迅速に作成することで、円滑な図書室運営と、教員が本来の教育活動へ専念できる時間の確保に貢献します。

## **2\. ユーザー側 概要設計（プロダクトの仕様）**

### **2.1. 主な機能と提供価値**

| 機能 | 提供する価値・内容 |
| :---- | :---- |
| **マスタデータ管理** | クラス管理: 年度当初に、割り当て対象となるクラスを登録・編集・削除します。 図書室管理: 当番を配置する図書室を登録・編集・削除します。 |
| **図書委員名簿の管理** | 年度当初に、その年の図書委員の氏名・学年・クラス（マスタから選択）を登録・編集・削除します。 |
| **当番表の自動生成** | ボタン一つで、全てのルールを遵守した前期・後期の当番表を自動で作成します。 |
| **当番表の表示と印刷** | 作成された当番表を画面上で分かりやすく確認し、**A4用紙での掲示に最適化されたシンプルなレイアウト**で印刷できます。 |
| **表示専用モード** | ログイン不要で閲覧のみが可能な、安全な「表示専用モード」を提供します。推測困難な専用URLを発行し、タブレット等での常時表示を可能にします。 |
| **年度更新** | 年度末や年度初めに、ボタン一つで前年度の全データをリセットし、まっさらな状態で新年度の準備を始められます。 |

**(ユーザーシナリオはUX設計書と重複するため省略)**

## **3\. システム側 概要設計（開発の仕様）**

### **3.1. システム要件**

* **形態:** Webアプリケーション  
* **データモデル:** データは単一年度のみを扱い、年度間のデータ引き継ぎは行わない（年度更新機能でリセット）。  
* **認証・権限:**  
  * **管理者ロール:** ID/パスワード認証により、全機能へのアクセスを許可。  
  * **表示用（匿名アクセス）:** 認証不要。推測困難なURLを知っている人のみ、当番表の閲覧が可能。編集・管理機能へのアクセスは不可とする。

### **3.2. データモデル（主なエンティティ）**

| エンティティ名 | 主なフィールド | 説明 |
| :---- | :---- | :---- |
| **クラス (Classes)** | id, name | 「5年1組」などのクラス情報。マスタデータ。 |
| **図書室 (Rooms)** | id, name | 「図書室A」などの図書室情報。マスタデータ。 |
| **図書委員 (Students)** | id, name, grade, class\_id | 委員の情報。クラスはClassesテーブルと連携。 |
| **割り当て (Assignments)** | id, student\_id, room\_id, day\_of\_week, term | 生成結果。どの委員が、いつ(曜日)、どこに、どの学期で割り当てられたかを記録。 |
| **設定 (Settings)** | id, key, value | keyにview\_only\_tokenなどを持ち、推測困難なURLを格納する。 |

### **3.3. 割り当てアルゴリズムの仕様**

本システムの中核であり、**制約最適化問題**として実装する。

#### **3.3.1. 絶対条件（Priority 1）**

* 登録された全図書委員を、**厳密に週2回ずつ**割り当てる。

#### **3.3.2. ハード制約（Priority 2：必ず満たすべきルール）**

* **同一クラス回避:** 同じクラスの委員は、同じ曜日に割り当てない。  
* **後期配慮:** 後期スケジュール生成時、前期で水曜または金曜だった委員は、後期の水曜・金曜には割り当てない。

#### **3.3.3. 最適化目標（Priority 3：可能な限り目指すべきバランス）**

アルゴリズムは、以下の評価指標を総合的に最大化（＝バランスが良い状態）する解を探索する。

1. **曜日ごとの負荷平準化:** 各曜日の合計当番人数が、理想値（総割り当て数 ÷ 5日間）に近くなるようにする。  
2. **スロットごとの人数平準化:** １つのスロットに割り当てられる人数が、極端に偏らないようにする。（例：1〜3人を目指す）  
3. **図書室ごとの負荷平準化:** １週間の総割り当て数が、図書室間で均等になることを目指す。  
4. **学年の均等配置:** 上記を満たした上で、各割り当て内の5年生と6年生の比率が偏らないようにする。

### **3.4. 運用・例外処理の仕様**

#### **3.4.1. 年度更新**

* 管理者が手動で実行する「年度更新」機能を提供する。  
* 実行時、確認ダイアログを表示の上、Classes, Students, Assignmentsの全データを物理削除し、システムを初期状態に戻す。

#### **3.4.2. 名簿修正時の割り当て更新（MVPフェーズ）**

* **方針:** 差分更新は行わず、**完全再生成方式**を採用する。  
* **フロー:**  
  1. ユーザーがClassesまたはStudentsのデータを変更（追加・編集・削除）する。  
  2. システムはデータ変更を検知し、既存のAssignmentsが最新情報に即していないことを内部的にフラグ管理する。  
  3. UI上でユーザーに「当番表の再作成」を促す。  
  4. ユーザーが「当番表を作成」ボタンを押すと、**再作成に伴う影響（全体が変更される可能性）を明記した警告ダイアログ**を表示する。  
  5. ユーザーの同意を得た後、既存のAssignmentsデータをすべて削除し、最新のマスタ・名簿情報を用いて、割り当てアルゴリズムをゼロから再実行する。

#### **3.4.3. 将来的な拡張（Post-MVP）**

* **個別編集機能:** MVPリリース後、ユーザーからのフィードバックに基づき、より柔軟な運用を可能にする「手動での個別編集機能」の追加を検討する。その際、ドラッグ＆ドロップ先の妥当性（ルール違反の有無）をリアルタイムで検証し、ユーザーを補助するUIを提供することが望ましい。